Link PlantUML
//www.plantuml.com/plantuml/dpng/vPZDRkCs4CVlUefvWQJ81x10W2mssswwHL30YDlwJ5aZYJ1D6HGL0NwPNl8CFUMc5oi7z9XcBCPmrhkNDH147_yPpioF8rBwr5fXRBTKcPZRni1q9L6X0T7295kvMt8kLq9Rc0qlfaGLNNiSdhiSJNmDsxRfp1pr4vfUADlfYhmz_lDALg7gqIo0xiqse_yfRKi1n3vzK6xm8ikij0hzXNLNmQ_22frbjxTmSSuXQYZT0JmsTMkRiaHZpV1S8TpUPja4pZwo3cw21OqlduH5c8H3JfdrPyvsugo-c0fpBLieq6n5GVNHvPfIiMydYIn2uad_1Uu5bWcr1ODiT0iViWpSZt9bHCuh7paiBTerQWYoK64d_1txuKMtyzewzRsxziTlCBmuqwMq5fKEPd7O3uuOGcknLhXRqHseuP2AITLaCng0Ca1Dta4rpGhk2QDGpDiPkGXWYJLTRU735l62N51S_hSR5jEuookH8r15lmxFghJ-EFB05K5TX6f7yQDgyL1yKuc5wdJrozIAmeBeIgYmzv0iBe4g6a9rmVbP5OS2Q6e7rrVZbJZ4apA2tTdYh49Qz4VTSdaENuKkN3whMhH8lK4fmRHHGbSXeLugbJKhcq3kVO3GkKIRWlwQo2RVEstxnlW2UJzKVaxNZRdrlbZZoaeqrjyV3uKh4QPIUaPCadgkqsWSUOKAQ-sBaSeg9ud33mMsNEF4R8gf-2f78oxb-FEKTC3QwviB-4jqhb-XgJKwsn9rzA0XPIWSTyGrL0hblCQTKkn9DzgPg1NCEdeec8quopRtP-x-n0mlfGkiTJ3BnXHeACgT86QHPsUpgLUmvETN5Yc5sXQZ6bwKbI7tq1JiB4GOUY9kXCYOcfcTTphfFiHwZxN3jaHLEFaD_CqsQDXD62tAcJcF7KSihm9BOkzEpppESOHN-mZV19-c2McQ7kQxMCBFpF8oPZbTuLeALR-1yp9W19GQ3TmP2nLMgE42SbGISqadxuPycF9Frh57GgR__ETMqQjp-2owxGfArDtvXY-TyJ9Q2-AekoeGzflKgJLY-1UZTItUZJq8RH7wuJdULGNDyKpVX4a0AOk8NZ8yph0K9iT86aJnzf9J1hy9pHAzy1dNmcTSu4ZEqOoWQCDqE7ega7sYsoFmHr3TR07Vm4gxm3Ufik59sVhVTqVC-KDEtG3lOmnmSigdXKpR-oo9E5I1COzGtkN7wHw6VXpekwxDVmJhTGVynaC3lhUrlJfcppby2tvoSUe-_w9jB-SBIh_rQrVi-tlWV72c33DHuVsuO26wz5j1M977REFr60v0ZRbHiDz4ZHmSPXRUQw_FDzGqF3LwFndDwpIpNGx_pMlhzriZTMkziuoh_oYjHKFtGdiS_iwIx3V-lCAA4tnLINnK6Ny33HjN9aP9tZV6qgxCvRgVQHn-KBPObhYm87JlOA2EVT9ZebfrUl7Q8qSS1D1BKq25Qtfgsj2LhxxAJB9FxagtLFy3

@startuml
actor Spieler as P
participant Würfel
participant Räuber
participant Ressourcenverwaltung as RV
participant Regelwerk as RW
actor Mitspieler
participant Spielfeld

title Spielzug Catan

== 1. Würfeln für Rohstofferträge ==

P -> Würfel : Würfeln 
activate P
activate Würfel
Würfel --> P : Ergebnis der Würfel

Würfel -> RV : Ergebnis der Würfel
activate RV

Würfel -> Mitspieler : Ergebnis der Würfel

deactivate Würfel

alt Würfelergebnis = 7

    P -> Räuber : Räuber versetzen 

    P -> Spielfeld : Gewünschter FeldID übermitteln

    P -> Mitspieler : Karte stehlen 
activate Mitspieler
Mitspieler -->> P : Karte übergeben
    loop Für alle Spieler mit mehr als 7 Rohstoffkarten

        Mitspieler -> RV : Abgabe der Hälfte der Rohstoffkarten 

    end
deactivate Mitspieler
else
    loop Für alle Spieler mit Siedlung/Stadt auf gewürfeltem Feld

        RV -> P : Rohstoffkarte erhalten
   
        RV -> Mitspieler: Rohstoffkarte erhalten 

deactivate RV

    end
end

== 2. Handelsphase ==
loop Solange Spieler will
opt
    P -> Mitspieler : Handel anbieten 
activate Mitspieler
    Mitspieler --> P : Antwort auf Handel 

    
    opt Handel akzeptiert

        P -> Mitspieler : Rohstoffe übergeben

        Mitspieler -> P : Rohstoffe übergeben

    end
    
    opt Handel abgelehnt
        Mitspieler --> P : Ablehnung des Handels
deactivate Mitspieler

    end
end

opt
    opt Handel mit Ressourcenverwaltung
        opt 4:1 Tausch ohne Hafen
activate RV
            P -> RV : 4 gleiche Rohstoffe 
            P ->> RV : Wahl Wunschrohstoff

P ->> RW : Prüfungsaufforderung

activate RW
            RW --> P : Prüfungsergebnis

            alt Handel gültig
                RV --> P : Wunschrohstoffkarte
deactivate RV
            else Handel ungültig
                RW --> P : Fehlermeldung: Ungültiger Handel 
deactivate RW
            end
        end
        
        opt 3:1 Tausch mit 3:1-Hafen
            P -> RV : 3 gleiche Rohstoffe
activate RV
            P ->> RV : Wahl Wunschrohstoff 
P ->> RW : Prüfungsauffoderung
activate RW
            RW --> P : Prüfungsergebnis 
            alt Handel gültig
                RV --> P : Wunschrohstoffkarte
deactivate RV
            else Handel ungültig
                RW --> P : Fehlermeldung: Ungültiger Handel 
deactivate RW
            end
        end
        
        opt 2:1 Tausch mit Spezialhafen
            P -> RV : 2 Rohstoffe einer Art gegen 1 beliebigen 
activate RV
            P ->> RV : Wahl Wunschrohstoff 

P ->> RW : Prüfungsauffoderung
activate RW
            RW --> P : Prüfungsergebnis

            alt Handel gültig
                RV --> P : Wunschrohstoffkarte
deactivate RV
            else Handel ungültig
                RW --> P : Fehlermeldung: Ungültiger Handel
deactivate RW
            end
        end
    end
end
end
== 3. Bauphase ==
opt Bauen
    opt Spieler hat genug Rohstoffe für Straße
        P ->> Spielfeld : Kante wählen 
activate Spielfeld
P ->> RW : Prüfungsauffoderung
activate RW
     RW --> P : Prüfungsergebnis
 alt Bau gültig
            P ->> Spielfeld : Spielerfarbe
            Spielfeld -> Spielfeld : Straße setzen

            P -> RV : Bezahlen 
deactivate Spielfeld
        else Bau ungültig
            RW --> P : Fehlermeldung: Ungültiger Bau 
deactivate RW
        end
    end

    opt Spieler hat genug Rohstoffe für Siedlung
        P ->> Spielfeld : Feld wählen 
activate Spielfeld
      P ->> RW : Prüfungsauffoderung
activate RW
     RW --> P : Prüfungsergebnis
        alt Bau gültig
            P ->> Spielfeld : Spielerfarbe
            Spielfeld -> Spielfeld : Siedlung bauen 

            P -> RV : Bezahlen 
deactivate Spielfeld  
        else Bau ungültig
            RW --> P : Fehlermeldung: Ungültiger Bau
deactivate RW
        end
    end

    opt Spieler hat genug Rohstoffe für Stadt

        P ->> Spielfeld : Siedlung wählen
activate Spielfeld
activate RW 
        P ->> RW : Prüfungsauffoderung
     RW --> P : Prüfungsergebnis
        alt Ausbau gültig
            P ->> Spielfeld : Spielerfarbe
            Spielfeld -> Spielfeld : Siedlung zu Stadt ausbauen

            P -> RV : Bezahlen 
deactivate Spielfeld       
        else Ausbau ungültig
            RW --> P : Fehlermeldung: Ungültiger Ausbau 
deactivate RW
        end
    end

    opt Spieler hat genug Rohstoffe für Entwicklungskarte
activate RW
        P ->> RW : Prüfungsauffoderung
     RW --> P : Prüfungsergebnis
        alt Kauf gültig

            P -> RV : Entwicklungskarte kaufen
activate RV
            RV --> P : Entwicklungskarte
deactivate RV 
            P -> RV : Bezahlen
        else Kauf ungültig
            RW --> P : Fehlermeldung: Ungültiger Kauf 
deactivate RW
        end
    end
end

== 4. Spielen von Entwicklungskarten ==
opt Spieler möchte eine Entwicklungskarte spielen
    alt Ritterkarte
        P -> Räuber : Räuber versetzen 
        P ->> Spielfeld : FeldID 
        P -> Mitspieler : Karte stehlen 
activate Mitspieler
Mitspieler --> P : Karte übergeben
deactivate Mitspieler
        
    else alt Fortschrittkarte
        P -> Spielfeld : Fortschrittseffekt anwenden 
    else alt Siegpunktkarte
        P --> P : Siegpunkt wird gezählt
    end

end
deactivate P
@enduml
